<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="errorReport"> 
 
<select id="getReportErrorCode" resultType="String">
 select distinct(e.error_code) as errorCode   from error e , error_report er where e.error_no = er.error_no and e.exception_message is null order by e.error_code asc  
</select>

<select id="getReportExceptionMessage" resultType="String">
select distinct(e.exception_message) as errorCode   from error e , error_report er where e.error_no = er.error_no and e.error_code is null order by e.exception_message asc
</select>

<select id="getContentException" parameterType="String" resultType="evo">
select e.error_no as errorNo ,e.exception_message as exceptionMessage, to_char(error_report_date,'yyyy/mm/dd HH24:MI') as reportdate , er.content as content ,er.discussion_status as discussionstatus from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.exception_message =#{value} and er.error_report_date = (select max(er.error_report_date)    from error_report er, error e  where er.error_no =e.error_no and  e.exception_message =#{value})
</select>
<select id="getContentErrorCode" parameterType="String" resultType="evo">
select e.error_no as errorNo ,e.error_code as errorCode, to_char(error_report_date,'yyyy/mm/dd HH24:MI') as reportdate , er.content as content, er.discussion_status as discussionstatus from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.error_code =#{value} and er.error_report_date = (select max(er.error_report_date)    from error_report er, error e  where er.error_no =e.error_no and  e.error_code =#{value})
</select>
<select id="showErrorReportVO" parameterType="int" resultType="evo">
select e.error_code as errorCode ,e.error_no as errorNo,  e.exception_message as exceptionMessage,to_char(error_report_date,'yyyy/mm/dd HH24:MI') as reportdate,er.content as content, er.id as id, er.discussion_status as discussionstatus from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.error_no = #{value}
</select>
<select id="writeResult" parameterType="String" resultType="evo">
select er.error_no as errorNo,e.error_code as errorCode ,  e.exception_message as exceptionMessage,to_char(error_report_date,'yyyy/mm/dd HH24:MI') as reportdate, er.id, er.discussion_status as discussionstatus from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.error_no = #{value}
</select>
<select id="currentValue" resultType="int">
select error_no.currval from dual
</select>
<select id="getReferException" parameterType="HashMap" resultType="evo">
select errorNo,exceptionMessage,reportdate,discussionstatus
from ( select errorNo,exceptionMessage,reportdate,discussionstatus,ceil(rownum/10) as page
from ( select e.error_no as errorNo ,e.exception_message as exceptionMessage, to_char(error_report_date,'yyyy/mm/dd HH24:MI') as reportdate  ,er.discussion_status as discussionstatus from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.exception_message =#{refer} order by reportDate desc
)) where page=#{pageNo}


</select>
<select id="getReferError" parameterType="HashMap" resultType="evo">
select errorNo, errorCode,reportdate, discussionstatus
from
( select errorNo, errorCode,reportdate, discussionstatus , ceil(rownum/10) as page
from (select e.error_no as errorNo ,e.error_code as errorCode, to_char(error_report_date,'yyyy/mm/dd HH24:MI') as reportdate  ,er.discussion_status as discussionstatus from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.error_code =#refer} order by reportDate desc)
) where page=#{pageNo}

</select>
<select id="getAllException" parameterType="String" resultType="int">
select count(*) from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.exception_message =#{value}
</select>
<select id="getAllError" parameterType="String" resultType="int">
select count(*) from ERROR_REPORT er, ERROR e where e.error_no = er.error_no and e.error_code =#{value}
</select>
<insert id="writeReportExceptionTitle" parameterType="String">
insert into error(error_no,exception_message) values(error_no.nextval,#{value})
</insert>
<insert id="writeReportException" parameterType="evo">
insert into error_report(error_report_no,error_no,id,error_report_date,content)
values(error_report_no.nextval,error_no.currval,#{id},sysdate,#{content})
</insert>
<insert id="writeReportErrorcodeTitle" parameterType="String">
insert into error(error_no,error_code) values(error_no.nextval,#{value})
</insert>
<insert id="writeReportErrorcode">
insert into error_report(error_report_no,error_no,id,error_report_date,content)
values(error_report_no.nextval,error_no.currval,#{id},sysdate,#{content})
</insert>

 </mapper> 		
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















